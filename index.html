<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEATHER ¬∑ –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0b0e14;
            color: #ffffff;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 420px;
            margin: 0 auto;
        }

        /* –°–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞ */
        body.light {
            background: #f8f9fc;
            color: #1a1e24;
        }

        body.light .card,
        body.light .search-section,
        body.light .forecast-card {
            background: #ffffff;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
        }

        body.light .search-input {
            background: #f0f3f7;
            color: #1a1e24;
        }

        body.light .detail-item,
        body.light .forecast-day {
            background: #f0f3f7;
        }

        /* –®–∞–ø–∫–∞ */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 18px;
            color: #8e98a3;
        }

        .theme-btn {
            background: none;
            border: none;
            font-size: 22px;
            cursor: pointer;
            padding: 8px;
            opacity: 0.8;
        }

        /* –ì–æ–ª–æ–≤–Ω–∞ –∫–∞—Ä—Ç–∫–∞ */
        .card {
            background: #1e222a;
            border-radius: 28px;
            padding: 28px 24px;
            margin-bottom: 16px;
        }

        .city {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .date {
            color: #8e98a3;
            font-size: 14px;
            margin-bottom: 16px;
        }

        .temp {
            font-size: 72px;
            font-weight: 800;
            line-height: 1;
            margin: 8px 0 4px;
        }

        .desc {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
            color: #8e98a3;
            margin-bottom: 28px;
        }

        /* –î–µ—Ç–∞–ª—ñ */
        .details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 8px;
        }

        .detail-item {
            background: #0b0e14;
            padding: 16px 12px;
            border-radius: 18px;
            text-align: center;
        }

        .detail-label {
            font-size: 13px;
            color: #8e98a3;
            margin-bottom: 6px;
        }

        .detail-value {
            font-size: 18px;
            font-weight: 700;
        }

        /* –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å */
        .forecast-section {
            margin-bottom: 16px;
        }

        .forecast-title {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #8e98a3;
            font-size: 14px;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .forecast-day {
            background: #1e222a;
            border-radius: 18px;
            padding: 16px 8px;
            text-align: center;
        }

        .forecast-weekday {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #8e98a3;
        }

        .forecast-emoji {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .forecast-temp {
            font-size: 16px;
            font-weight: 700;
        }

        .forecast-temp span {
            color: #8e98a3;
            font-size: 14px;
        }

        /* –ü–æ—à—É–∫ */
        .search-section {
            background: #1e222a;
            border-radius: 28px;
            padding: 24px;
            margin-bottom: 16px;
        }

        .search-input {
            width: 100%;
            background: #0b0e14;
            border: none;
            border-radius: 18px;
            padding: 18px 20px;
            color: #ffffff;
            font-size: 17px;
            margin-bottom: 12px;
        }

        .search-input::placeholder {
            color: #4a525c;
        }

        .search-btn {
            width: 100%;
            background: #2a7f6e;
            border: none;
            border-radius: 18px;
            padding: 18px;
            color: white;
            font-weight: 700;
            font-size: 17px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .search-btn:hover {
            background: #1e5f52;
        }

        /* –°—Ç–∞—Ç—É—Å */
        .status {
            text-align: center;
            color: #8e98a3;
            font-size: 13px;
            padding: 8px;
        }

        /* –ê–Ω—ñ–º–∞—Ü—ñ—è */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading {
            animation: pulse 1.5s ease-in-out infinite;
        }

        /* –°–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞ */
        body.light .forecast-day {
            background: #f0f3f7;
        }
    </style>
</head>
<body class="dark">
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <div class="logo">
                <span>üå§Ô∏è</span>
                <span>weather ¬∑ –ø—Ä–æ–≥–Ω–æ–∑</span>
            </div>
            <button class="theme-btn" onclick="toggleTheme()" id="themeToggle">üåô</button>
        </div>

        <!-- –°—å–æ–≥–æ–¥–Ω—ñ -->
        <div class="card" id="weatherCard">
            <div class="city" id="cityName">–ö–∏—ó–≤</div>
            <div class="date" id="currentDate">14 –∫–≤—ñ—Ç–Ω—è 2025</div>
            <div class="temp" id="temperature">22¬∞</div>
            <div class="desc" id="description">
                <span>‚òÄÔ∏è</span>
                <span>–°–æ–Ω—è—á–Ω–æ</span>
            </div>
            
            <div class="details">
                <div class="detail-item">
                    <div class="detail-label">–í—ñ–¥—á—É–≤–∞—î—Ç—å—Å—è</div>
                    <div class="detail-value" id="feelsLike">20¬∞</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">–í—ñ—Ç–µ—Ä</div>
                    <div class="detail-value" id="wind">5 –º/—Å</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">–í–æ–ª–æ–≥—ñ—Å—Ç—å</div>
                    <div class="detail-value" id="humidity">65%</div>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å -->
        <div class="forecast-section">
            <div class="forecast-title">
                <span>üìÖ</span>
                <span>–ü–†–û–ì–ù–û–ó –ù–ê 7 –î–ù–Ü–í</span>
            </div>
            <div class="forecast-grid" id="forecastGrid">
                <!-- JavaScript –¥–æ–¥–∞—Å—Ç—å –¥–Ω—ñ -->
            </div>
        </div>

        <!-- –ü–æ—à—É–∫ -->
        <div class="search-section">
            <input 
                type="text" 
                class="search-input" 
                id="cityInput" 
                placeholder="–ù–∞–∑–≤–∞ –º—ñ—Å—Ç–∞: –ö–∏—ó–≤, –õ—å–≤—ñ–≤, London..."
                value="–ö–∏—ó–≤"
                autocomplete="off"
                autofocus
            >
            <button class="search-btn" onclick="getWeather()">
                <span>üîç</span>
                <span>–û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ–≥–Ω–æ–∑</span>
            </button>
        </div>

        <!-- –°—Ç–∞—Ç—É—Å -->
        <div class="status" id="status">
            üá∫üá¶ Weather ¬∑ –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å
        </div>
    </div>

    <script>
        // API KEY
        const API_KEY = "0f8d4d200034367f49673052d36188f1";

        // Telegram Web App
        if (window.Telegram?.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
        }

        // –¢–µ–º–∏
        function toggleTheme() {
            const body = document.body;
            const toggle = document.getElementById('themeToggle');
            
            if (body.classList.contains('dark')) {
                body.classList.remove('dark');
                body.classList.add('light');
                toggle.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.remove('light');
                body.classList.add('dark');
                toggle.textContent = 'üåô';
                localStorage.setItem('theme', 'dark');
            }
        }

        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.body.classList.add(savedTheme);
        document.getElementById('themeToggle').textContent = savedTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';

        // –î–Ω—ñ —Ç–∏–∂–Ω—è
        const weekdays = ['–ù–µ–¥—ñ–ª—è', '–ü–æ–Ω–µ–¥—ñ–ª–æ–∫', '–í—ñ–≤—Ç–æ—Ä–æ–∫', '–°–µ—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä', '–ü º—è—Ç–Ω–∏—Ü—è', '–°—É–±–æ—Ç–∞'];
        const shortWeekdays = ['–ù–¥', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞—Ç–∏
        function updateDate() {
            const now = new Date();
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            document.getElementById('currentDate').textContent = 
                now.toLocaleDateString('uk-UA', options);
        }
        updateDate();

        // –û—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–≥–æ–¥—É
        async function getWeather() {
            let city = document.getElementById('cityInput').value.trim();
            if (!city) city = 'Kyiv';

            // –ú–∞–ø–∞ –º—ñ—Å—Ç
            const cityMap = {
                '–∫–∏—ó–≤': 'Kyiv', 'kiev': 'Kyiv', 'kyiv': 'Kyiv',
                '–ª—å–≤—ñ–≤': 'Lviv', 'lviv': 'Lviv',
                '–æ–¥–µ—Å–∞': 'Odesa', 'odesa': 'Odesa', 'odessa': 'Odesa',
                '—Ö–∞—Ä–∫—ñ–≤': 'Kharkiv', 'kharkiv': 'Kharkiv',
                '–¥–Ω—ñ–ø—Ä–æ': 'Dnipro', 'dnipro': 'Dnipro',
                '–ª–æ–Ω–¥–æ–Ω': 'London', 'london': 'London',
                '–ø–∞—Ä–∏–∂': 'Paris', 'paris': 'Paris',
                '–±–µ—Ä–ª—ñ–Ω': 'Berlin', 'berlin': 'Berlin',
                '–≤–∞—Ä—à–∞–≤–∞': 'Warsaw', 'warsaw': 'Warsaw',
                '–Ω—å—é-–π–æ—Ä–∫': 'New York', 'new york': 'New York',
                '—Ç–æ–∫—ñ–æ': 'Tokyo', 'tokyo': 'Tokyo'
            };

            let searchCity = cityMap[city.toLowerCase()] || city;
            
            const statusEl = document.getElementById('status');
            statusEl.innerHTML = '‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–≥–Ω–æ–∑—É...';
            statusEl.classList.add('loading');

            try {
                // –ü–æ—Ç–æ—á–Ω–∞ –ø–æ–≥–æ–¥–∞
                const weatherResponse = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?q=${searchCity}&appid=${API_KEY}&units=metric&lang=uk`
                );
                
                if (!weatherResponse.ok) throw new Error('–ú—ñ—Å—Ç–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
                
                const weatherData = await weatherResponse.json();
                
                // –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 7 –¥–Ω—ñ–≤ (5 –¥–Ω—ñ–≤ / 3 –≥–æ–¥–∏–Ω–∏ = 40 –∑–∞–ø–∏—Å—ñ–≤)
                const forecastResponse = await fetch(
                    `https://api.openweathermap.org/data/2.5/forecast?q=${searchCity}&appid=${API_KEY}&units=metric&lang=uk`
                );
                const forecastData = await forecastResponse.json();
                
                // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞
                let displayCity = city;
                for (let [uk, en] of Object.entries(cityMap)) {
                    if (en.toLowerCase() === searchCity.toLowerCase()) {
                        displayCity = uk.charAt(0).toUpperCase() + uk.slice(1);
                        break;
                    }
                }
                
                // –û–Ω–æ–≤–ª—é—î–º–æ –ø–æ—Ç–æ—á–Ω—É –ø–æ–≥–æ–¥—É
                document.getElementById('cityName').textContent = displayCity;
                document.getElementById('temperature').textContent = `${Math.round(weatherData.main.temp)}¬∞`;
                document.getElementById('feelsLike').textContent = `${Math.round(weatherData.main.feels_like)}¬∞`;
                document.getElementById('wind').textContent = `${weatherData.wind.speed} –º/—Å`;
                document.getElementById('humidity').textContent = `${weatherData.main.humidity}%`;
                
                // –ï–º–æ–¥–∑—ñ –ø–æ—Ç–æ—á–Ω–æ—ó –ø–æ–≥–æ–¥–∏
                const weatherId = weatherData.weather[0].id;
                let emoji = '‚òÄÔ∏è';
                let desc = weatherData.weather[0].description.charAt(0).toUpperCase() + 
                          weatherData.weather[0].description.slice(1);
                
                if (weatherId >= 200 && weatherId < 300) { emoji = '‚õàÔ∏è'; desc = '–ì—Ä–æ–∑–∞'; }
                else if (weatherId >= 300 && weatherId < 400) { emoji = 'üåßÔ∏è'; desc = '–ú—Ä—è–∫–∞'; }
                else if (weatherId >= 500 && weatherId < 600) { emoji = 'üå¶Ô∏è'; desc = '–î–æ—â'; }
                else if (weatherId >= 600 && weatherId < 700) { emoji = '‚ùÑÔ∏è'; desc = '–°–Ω—ñ–≥'; }
                else if (weatherId >= 700 && weatherId < 800) { emoji = 'üå´Ô∏è'; desc = '–¢—É–º–∞–Ω'; }
                else if (weatherId === 800) { emoji = '‚òÄÔ∏è'; desc = '–Ø—Å–Ω–æ'; }
                else if (weatherId > 800) { emoji = '‚òÅÔ∏è'; desc = '–•–º–∞—Ä–Ω–æ'; }
                
                document.getElementById('description').innerHTML = 
                    `<span>${emoji}</span><span>${desc}</span>`;
                
                // –ì–µ–Ω–µ—Ä—É—î–º–æ –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å
                generateForecast(forecastData.list);
                
                statusEl.innerHTML = 'üá∫üá¶ Weather ¬∑ –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 7 –¥–Ω—ñ–≤';
                statusEl.classList.remove('loading');
                
                // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –≤ Telegram
                if (window.Telegram?.WebApp) {
                    Telegram.WebApp.sendData(JSON.stringify({
                        city: displayCity,
                        temp: Math.round(weatherData.main.temp),
                        weather: desc,
                        forecast: '7days'
                    }));
                }
                
            } catch (error) {
                statusEl.innerHTML = '‚ùå –ú—ñ—Å—Ç–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
                statusEl.classList.remove('loading');
                
                document.getElementById('cityName').textContent = '‚Äî';
                document.getElementById('temperature').textContent = '--¬∞';
                document.getElementById('description').innerHTML = 
                    `<span>‚ùì</span><span>–°–ø—Ä–æ–±—É–π—Ç–µ —â–µ</span>`;
                
                // –û—á–∏—â–∞—î–º–æ –ø—Ä–æ–≥–Ω–æ–∑
                document.getElementById('forecastGrid').innerHTML = '';
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø—Ä–æ–≥–Ω–æ–∑—É –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å
        function generateForecast(forecastList) {
            const forecastGrid = document.getElementById('forecastGrid');
            forecastGrid.innerHTML = '';
            
            // –ë–µ—Ä–µ–º–æ –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –∫–æ–∂–µ–Ω –¥–µ–Ω—å (–æ 12:00)
            const dailyForecasts = [];
            const today = new Date().setHours(0,0,0,0);
            
            for (let i = 0; i < forecastList.length; i++) {
                const item = forecastList[i];
                const date = new Date(item.dt * 1000);
                const dateStr = date.setHours(0,0,0,0);
                
                // –ë–µ—Ä–µ–º–æ —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –¥–µ–Ω—å (–±–ª–∏–∑—å–∫–æ 12:00)
                if (date.getHours() >= 11 && date.getHours() <= 14) {
                    if (!dailyForecasts.find(f => new Date(f.dt * 1000).setHours(0,0,0,0) === dateStr)) {
                        dailyForecasts.push(item);
                    }
                }
            }
            
            // –ë–µ—Ä–µ–º–æ –º–∞–∫—Å–∏–º—É–º 7 –¥–Ω—ñ–≤
            const weekForecast = dailyForecasts.slice(0, 7);
            
            weekForecast.forEach((day, index) => {
                const date = new Date(day.dt * 1000);
                const weekday = shortWeekdays[date.getDay()];
                const temp = Math.round(day.main.temp);
                
                // –ï–º–æ–¥–∑—ñ
                const weatherId = day.weather[0].id;
                let emoji = '‚òÄÔ∏è';
                if (weatherId >= 200 && weatherId < 300) emoji = '‚õàÔ∏è';
                else if (weatherId >= 300 && weatherId < 400) emoji = 'üåßÔ∏è';
                else if (weatherId >= 500 && weatherId < 600) emoji = 'üå¶Ô∏è';
                else if (weatherId >= 600 && weatherId < 700) emoji = '‚ùÑÔ∏è';
                else if (weatherId >= 700 && weatherId < 800) emoji = 'üå´Ô∏è';
                else if (weatherId === 800) emoji = '‚òÄÔ∏è';
                else if (weatherId > 800) emoji = '‚òÅÔ∏è';
                
                const dayElement = document.createElement('div');
                dayElement.className = 'forecast-day';
                dayElement.innerHTML = `
                    <div class="forecast-weekday">${weekday}</div>
                    <div class="forecast-emoji">${emoji}</div>
                    <div class="forecast-temp">${temp}¬∞<span></span></div>
                `;
                
                forecastGrid.appendChild(dayElement);
            });
            
            // –Ø–∫—â–æ –º–µ–Ω—à–µ 7 –¥–Ω—ñ–≤, –¥–æ–¥–∞—î–º–æ –∑–∞–≥–ª—É—à–∫–∏
            for (let i = weekForecast.length; i < 7; i++) {
                const date = new Date();
                date.setDate(date.getDate() + i);
                const weekday = shortWeekdays[date.getDay()];
                
                const dayElement = document.createElement('div');
                dayElement.className = 'forecast-day';
                dayElement.innerHTML = `
                    <div class="forecast-weekday">${weekday}</div>
                    <div class="forecast-emoji">‚Äî</div>
                    <div class="forecast-temp">--¬∞</div>
                `;
                
                forecastGrid.appendChild(dayElement);
            }
        }

        // –ü–æ—à—É–∫ –ø–æ Enter
        document.getElementById('cityInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                getWeather();
            }
        });

        // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –ø–æ–≥–æ–¥—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
        window.onload = () => {
            updateDate();
            getWeather();
        };
    </script>
</body>
</html>
